{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Карта</title>
  <link rel="icon" href="{% static 'images/fire.png' %}" type="image/icon type">
  <script src="{% static 'jquery/jquery-3.2.1.min.js' %}"></script>
  <script src="{% static 'javascript/assets/particles.min.js' %}"></script>
</head>
<body>
  <style>.map {
    width: 100%;
    height: 100vh;
    background-color: #333;
  }
  </style>
  <style>
    
</style>
  <div id="map-test" class="map"></div>
  <script src="https://api-maps.yandex.ru/2.1/?apikey=81c87445-f1fe-4e16-8b33-c83baf78e8f2&lang=ru_RU"></script>
  <script>
    let center = [42.899657, 71.392727];
    function init()
    {
      let map = new ymaps.Map('map-test',{
        center: center,
        zoom: 16
        });
      var searchControl = new ymaps.control.SearchControl({
        options: {
          provider: 'yandex#search'
                 }
        });

      objectManager = new ymaps.ObjectManager({
                                              geoObjectOpenBalloonOnClick: false
                                              });
      map.geoObjects.add(objectManager);

      searchControl.events.add('resultselect', function (e) {
      var results = searchControl.getResultsArray(),
      selected = e.get('index'),
      point = results[selected].geometry.getCoordinates();
      console.log(point)
        })

      map.events.add('dblclick', function (e)
      {

        var coords = e.get('coords');

        let placemark = new ymaps.Placemark(coords,
          {
            balloonContent: 'Вы выбрали локацию как место текущего пожара',
          },
          {
          balloonPanelMaxMapArea: 0,
          iconLayout: 'default#image',
          iconImageHref: "{% static 'images/fire.png' %}",
          iconImageSize: [50, 50],
          iconImageOffset: [-10, -20]
        });
        map.geoObjects.add(placemark);
        placemark.balloon.open();
        e.preventDefault();
  });
}



let url = `ws://${window.location.host}/ws/socket-server/`
const chatSocket = new WebSocket(url)

chatSocket.onmessage = function(e){
    let data = JSON.parse(e.data)
    console.log('Data:', data)
    if(data.type === 'chat')
    {
        var messages = document.getElementsByTagName("input")[0];
        console.log(messages)
        messages.value = "Казахстан, Тараз, " +data.message +" "+ data.message2
    }
 }
ymaps.ready(init);
  </script>
</body>
</html>
